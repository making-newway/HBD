var angle = 0;
var particle = [];
var font;
var drawing;
var y = [];
var x = [];
let fort;
let c = [];
let e = 0;

function setup() {
    let t = 0;
    createCanvas(windowWidth, windowHeight);
    
    for(let i = 0; i < neme.length; i+=2) {
        x.push(neme[i].x);
        y.push(neme[i].y);
    }
    fortY = dft(y);
    fortX = dft(x);

    fortX.sort((a, b) => b.amp - a.amp);
    fortY.sort((a, b) => b.amp - a.amp);
}
function draw() {
    background(17);
    const p = fortY.length;

    strokeWeight(1);
    let vy = epicycles(100, 400, fortY, HALF_PI);
    let vx = epicycles(800, 100, fortX, 0);
    let v = createVector(vx.x , vy.y);
    particle.unshift(v);

    line(vx.x, vx.y, v.x, v.y);
    line(vy.x, vy.y, v.x, v.y);

    beginShape();
    noFill();
    for(let i = 0 ; i < particle.length ; i++)
    {
        vertex(particle[i].x, particle[i].y);
    }
    endShape();

    if(particle.length > width) {
        particle.pop();
    }


    fill(150, 0, 100, angle);
    translate(width/2 , height/2 + 200);
    strokeWeight(8);
    beginShape();
    for(let i = 0; i < c.length; i++) {
        vertex(c[i].x, c[i].y);
    }
    endShape(CLOSE)

    x = 10 * 16 * pow(sin(e), 3);
    y = -10 * ((13 * cos(e)) - (5 * cos(2 * e)) - (2 * cos(3 * e)) - cos(4 * e));
    c.push(createVector(x, y));
    e += 0.01;

    angle += TWO_PI/p;
}


function epicycles(x, y, fort, rot) {
    for(let i = 0; i < fort.length; i++) {
        let prevx = x;
        let prevy = y;

        stroke(255, 100);
        noFill();

        let n = fort[i].freq;
        let radius = fort[i].amp;
        let phase = fort[i].phs;

        x += radius * cos(( n * angle ) + phase + rot);
        y += radius * sin(( n * angle ) + phase + rot);

        
        noFill();
        circle(prevx, prevy, radius*2);

        stroke(255, 255);
        line(prevx, prevy, x, y);
    }
    return createVector(x, y);
}


function dft(val) {
    let rets = [];
    const N = val.length;
    for(let i = 0 ; i < N ; i++)
    {
        let re = 0;
        let im = 0;
        for(let j = 0 ; j < N ; j++)
        {
            const phi = TWO_PI * i * j / N;
            re += val[j] * cos(phi);
            im -= val[j] * sin(phi);
        }
        re = re / N;
        im = im / N;

        let freq = i;
        let amp = sqrt((re*re) + (im*im));
        let phs = atan2(im, re);
        rets[i] = { re, im, freq, amp, phs };
    }
    return rets;
}



var neme = [
    { x: 65.8610361328125, y :0},{ x: 74.18880511665344, y :0},{ x: 82.51720482087136, y :0},{ x: 90.85299353027344, y :0},{ x: 94.69031865662522, y :-5.561340963542462},{ x: 96.42858679304459, y :-13.71016483873129},{ x: 98.1685455394287, y :-21.866914121143523},{ x: 99.90598646469601, y :-30.011860114753247},{ x: 101.64402137449153, y :-38.15959064729791},{ x: 103.38470694138297, y :-46.319747190177445},{ x: 105.1207275270971, y :-54.45803477670998},{ x: 106.8599806467097, y :-62.611476152728315},{ x: 108.59807811798156, y :-70.75949996709824},{ x: 110.33865655517579, y :-78.919154296875},{ x: 112.07436745389342, y :-87.05599010232837},{ x: 113.81422581685683, y :-95.21226879749447},{ x: 115.55261961263281, y :-103.3616817509411},{ x: 117.29206656181813, y :-111.51603178024293},{ x: 119.0287449928131, y :-119.65740327841044},{ x: 120.76791015660459, y :-127.8104323265031},{ x: 122.50769251801259, y :-135.96635473412277},{ x: 120.97723853498155, y :-142.31979742155428},{ x: 112.78656696177431, y :-143.7942568359375},{ x: 104.46412221122888, y :-143.70911879326013},{ x: 96.41338812221278, y :-141.69436126674404},{ x: 88.87740276908353, y :-138.13502239798981},{ x: 81.87465072892286, y :-133.63824411271193},{ x: 75.33879197409044, y :-128.45378611471546},{ x: 69.2475076237534, y :-122.77739719192043},{ x: 63.51933474871999, y :-116.74164501812572},{ x: 58.10988448700101, y :-110.3867250100693},{ x: 53.00093618544867, y :-103.8139254882395},{ x: 48.10849730639266, y :-97.05103121529606},{ x: 43.45812436595271, y :-90.1539033125034},{ x: 36.655500720977784, y :-87.75375000000001},{ x: 28.334758023496494, y :-87.87582011132699},{ x: 20.05214527739985, y :-86.99883245944591},{ x: 11.989429259468338, y :-84.93717798837181},{ x: 4.40727684127463, y :-81.48822969037074},{ x: -2.131934392819465, y :-76.36240343494126},{ x: -6.604306610944834, y :-69.40871920268904},{ x: -7.171264160156251, y :-61.2038989338465},{ x: -2.2828533871640175, y :-54.791046346658774},{ x: 5.782014442071646, y :-53.23445690917969},{ x: 13.367389160156252, y :-56.27945947265626},{ x: 14.569873535156251, y :-64.0535825983733},{ x: 15.38877284217887, y :-70.76402673475071},{ x: 22.701534023902024, y :-74.61685840081925},{ x: 30.86007536207231, y :-76.22183765995784},{ x: 33.136048828125, y :-73.09511279296875},{ x: 29.178070312499997, y :-65.765232421875},{ x: 25.442544067382812, y :-58.3063327331543},{ x: 21.944097564697266, y :-50.75071094309348},{ x: 18.6528515625, y :-43.104234752286224},{ x: 15.585275390625, y :-35.348683861321305},{ x: 12.795284179687501, y :-27.495361550533328},{ x: 10.366740966796876, y :-19.520888540031898},{ x: 8.411035858154298, y :-11.43543358582992},{ x: 7.147519409179688, y :-3.195665247604906},{ x: 7.079102050781249, y :5.121886371385132},{ x: 9.433609497070313, y :13.038496987208763},{ x: 15.285217007231433, y :18.853693129241464},{ x: 23.17049967956543, y :21.38400032043457},{ x: 31.485193729698658, y :21.879539007530084},{ x: 30.17824365234375, y :15.211801400381082},{ x: 30.052261112442057, y :6.8881216142864945},{ x: 30.919765074631044, y :-1.3950098042759738},{ x: 32.38116170166805, y :-9.590583618164063},{ x: 34.19402984571923, y :-17.72245083618164},{ x: 36.27309919308498, y :-25.794802368164063},{ x: 38.58309024230336, y :-33.80371005249023},{ x: 41.12186393895669, y :-41.74759130859375},{ x: 43.86211112448322, y :-49.609370567321776},{ x: 46.794480375640156, y :-57.4195794967339},{ x: 49.89884892591376, y :-65.13960023054022},{ x: 53.189182283757944, y :-72.79308987653138},{ x: 59.0389921875, y :-76.12664041307197},{ x: 67.201482421875, y :-74.51994138371805},{ x: 75.14372915450787, y :-71.97726968265182},{ x: 80.14810986328123, y :-67.37708935546874},{ x: 78.41868770210445, y :-59.22409916706383},{ x: 76.68787307716906, y :-51.064544506654144},{ x: 74.95847712611338, y :-42.91167788024875},{ x: 73.23175782411731, y :-34.77142974226736},{ x: 71.50056132993218, y :-26.610074841108872},{ x: 69.7693400066346, y :-18.448602888420222},{ x: 68.04140610777027, y :-10.302628793774172},{ x: 66.31466732025146, y :-2.1622887954711913},{ x: 93.5019715576172, y :-130.3584873046875},{ x: 91.76705759778993, y :-122.22233907929062},{ x: 90.02630666041375, y :-114.0588174419403},{ x: 88.29058345400915, y :-105.91887412914636},{ x: 86.55424580731989, y :-97.77604930329323},{ x: 84.81528658885136, y :-89.62093020978571},{ x: 83.07729554924369, y :-81.47035154128075},{ x: 77.75826486789063, y :-79.91302449137406},{ x: 69.80174980642322, y :-82.36316732847666},{ x: 61.68750028009073, y :-84.30750451428018},{ x: 61.469080902099606, y :-89.78223275756835},{ x: 65.482530418396, y :-97.07874318695069},{ x: 69.77370943450927, y :-104.21913411712646},{ x: 74.37329919433594, y :-111.17020349121094},{ x: 79.36052828979493, y :-117.85313882446289},{ x: 84.98068551635743, y :-123.99763394165038},{ x: 91.475044921875, y :-129.18121289062498},{ x: 166.2668239746094, y :-126.33530053710938},{ x: 158.01474505376814, y :-125.2201547369957},{ x: 149.7628609047532, y :-124.1050352573991},{ x: 141.4982341634631, y :-122.9881938058734},{ x: 136.86582069969177, y :-117.94117521858216},{ x: 135.09409556007384, y :-109.79123957633973},{ x: 133.32459951853753, y :-101.6515577852726},{ x: 129.55541416168214, y :-96},{ x: 124.87095050811767, y :-91.55475254058838},{ x: 129.26252658748626, y :-88.32000000000001},{ x: 129.08928284883498, y :-81.43214134204388},{ x: 127.35103775024413, y :-73.29136013031007},{ x: 125.60762695312499, y :-65.12638623046875},{ x: 123.87127517390996, y :-56.99447206447833},{ x: 122.13093515541404, y :-48.843879644522445},{ x: 120.38969646781683, y :-40.68907845760882},{ x: 118.67213846862707, y :-32.53581528747473},{ x: 117.57881847058432, y :-24.279125355349947},{ x: 117.91779989885262, y :-15.969769409179689},{ x: 120.4875887435496, y :-8.080321014404298},{ x: 126.22696877721584, y :-2.1628418884277343},{ x: 133.94271070594232, y :0.8179686584472657},{ x: 142.248, y :0.8640000000000001},{ x: 150.37030493028473, y :-0.92749658203125},{ x: 157.76602035562536, y :-4.729120147705078},{ x: 164.14459186698775, y :-10.064613866291886},{ x: 169.53362288260593, y :-16.414382755148225},{ x: 173.85267225228623, y :-23.540647705793386},{ x: 177.2032995343593, y :-31.156232700035673},{ x: 173.4448435821533, y :-34.368},{ x: 168.47482244690136, y :-29.52143401916698},{ x: 163.78122814257816, y :-22.669949089843783},{ x: 156.92681182551382, y :-18.091921632606535},{ x: 148.7247660570927, y :-18.102375432092696},{ x: 145.15481541959775, y :-24.92615772493349},{ x: 146.4362469034195, y :-33.13990735977888},{ x: 148.17380859374998, y :-41.284727783203124},{ x: 149.91380648481845, y :-49.440967897586525},{ x: 151.6547694979906, y :-57.60173202183098},{ x: 153.3911308389902, y :-65.74092580776662},{ x: 155.13100105190279, y :-73.89656743079425},{ x: 156.8695768432617, y :-82.04614145278931},{ x: 160.1232254462242, y :-88.32000000000001},{ x: 168.4511428527832, y :-88.32000000000001},{ x: 171.11110693359376, y :-95.23553466796875},{ x: 163.70853048706056, y :-96},{ x: 160.66545743751527, y :-100.28206691551209},{ x: 162.41802291297913, y :-108.42634177207947},{ x: 164.170566696167, y :-116.57051582336426},{ x: 165.92563542866708, y :-124.72642346262933},{ x: 211.00296386718747, y :-96},{ x: 202.67519488334653, y :-96},{ x: 194.34679517912863, y :-96},{ x: 186.01100646972657, y :-96},{ x: 182.18154652604832, y :-90.44125719834119},{ x: 180.45216692368453, y :-82.28380624379497},{ x: 178.72272094388677, y :-74.12604218814522},{ x: 176.99724947674198, y :-65.98702583368868},{ x: 175.2688419610611, y :-57.83416019368451},{ x: 173.53795995733094, y :-49.669622440240346},{ x: 171.81261846677165, y :-41.53121918288525},{ x: 170.0832950426638, y :-33.374033220112324},{ x: 168.35524841308592, y :-25.222869873046875},{ x: 166.62600668250442, y :-17.066069257096387},{ x: 164.89983319876714, y :-8.923741503618658},{ x: 163.17182227134703, y :-0.7727465629577637},{ x: 170.5629375, y :0},{ x: 178.89066868400573, y :0},{ x: 187.2241842405796, y :0},{ x: 191.66678069642185, y :-4.801208308003844},{ x: 193.38436089134217, y :-12.959714233875276},{ x: 195.09874841308593, y :-21.103054962158208},{ x: 196.81499597167968, y :-29.255230865478516},{ x: 198.5328558333814, y :-37.41506520856172},{ x: 200.2500690270625, y :-45.571827878546905},{ x: 201.96527458539606, y :-53.719054280631255},{ x: 203.6831466064453, y :-61.87894638061524},{ x: 205.39962684845923, y :-70.03222753018142},{ x: 210.1125271815143, y :-76.39106363488584},{ x: 217.36368827963992, y :-80.34608543774624},{ x: 223.1445237919204, y :-76.66342971036583},{ x: 226.86674267578124, y :-69.44121636370086},{ x: 235.02480432128908, y :-68.99856084788655},{ x: 241.87808789062498, y :-73.47045114472462},{ x: 244.91980664062498, y :-81.11699974600319},{ x: 243.59618744434283, y :-89.25893574090034},{ x: 238.26980701197766, y :-95.46403376486938},{ x: 230.1862694091797, y :-96.89025874302483},{ x: 222.2641072998047, y :-94.46143029546982},{ x: 215.2956886628403, y :-89.89429610690195},{ x: 208.9522897693183, y :-84.50807242216541},{ x: 209.9379076709747, y :-91.18458451938629},{ x: 259.39200105285715, y :-121.52981295776299},{ x: 261.5630914948724, y :-113.59470220629944},{ x: 267.59135699814794, y :-107.98687249403955},{ x: 275.65966001353763, y :-106.4021125694702},{ x: 283.4233414121079, y :-109.1174886660171},{ x: 288.69298023963984, y :-115.44988584922737},{ x: 289.7927007523667, y :-123.61303850544576},{ x: 286.52691240198305, y :-131.15332587926696},{ x: 279.86286478836155, y :-135.9933903385916},{ x: 271.64951354516944, y :-136.63981799779933},{ x: 264.33209164474084, y :-132.8972594294779},{ x: 259.98107764065026, y :-125.92093517673256},{ x: 283.1949638671875, y :-96},{ x: 274.86719488334654, y :-96},{ x: 266.53879517912867, y :-96},{ x: 258.2030064697266, y :-96},{ x: 254.3732287021056, y :-90.43550607905723},{ x: 252.6463434163928, y :-82.28359171561897},
    { x: 250.92137719756366, y :-74.14073647673428},{ x: 249.1913274583742, y :-65.97388403144292},{ x: 247.4645003137216, y :-57.8222441280093},{ x: 245.74010096025467, y :-49.682064827084545},{ x: 244.01283703511953, y :-41.52836306284368},{ x: 242.29038445328416, y :-33.36640355728806},{ x: 241.09359978904374, y :-25.12944964255936},{ x: 241.25766913673615, y :-16.809152069091798},{ x: 243.53859258375843, y :-8.834474487304687},{ x: 248.9873382312912, y :-2.63613427734375},{ x: 256.56498028692056, y :0.6601610412597658},{ x: 264.86165611749885, y :0.961875},{ x: 273.02084325548265, y :-0.6516543273925781},{ x: 280.50630075971196, y :-4.264767608642578},{ x: 286.99199926757814, y :-9.456000366210938},{ x: 292.47895387438746, y :-15.730286481957883},{ x: 296.90947617203074, y :-22.76902158565354},{ x: 300.34829377727044, y :-30.35334661773965},{ x: 297.76837512016294, y :-34.367999999999995},{ x: 292.28612206799255, y :-30.294414609496485},{ x: 287.8217760309773, y :-23.302378142793664},{ x: 281.18455885006114, y :-18.38256487184365},{ x: 272.99928258989024, y :-17.85002380082774},{ x: 268.61549998927114, y :-24.081749989271163},{ x: 269.71086907482146, y :-32.30132618665695},{ x: 271.43812383162975, y :-40.457806982696056},{ x: 273.16718003712595, y :-48.62279461976141},{ x: 274.8917537629623, y :-56.7666149917664},{ x: 276.61695200975237, y :-64.9133844904974},{ x: 278.34561314678194, y :-73.07650652647018},{ x: 280.07175786173343, y :-81.22774545818567},{ x: 281.7984053878784, y :-89.38135877609253}
]
